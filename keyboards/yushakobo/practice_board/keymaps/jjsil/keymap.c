// Copyright 2023 QMK
// SPDX-License-Identifier: GPL-2.0-or-later

#include QMK_KEYBOARD_H

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = LAYOUT(
        KC_G,    KC_D,    KC_BSLS,    // Lightroom navigate and compare
        KC_COMM, KC_DOT,  LCMD(KC_U), // Lightroom Develop change adjustments and auto
        OSL(3),  KC_NO,   KC_NO       // Rotoencoder press is the first in this row
    ),
    [1] = LAYOUT(
        KC_5,    KC_LBRC, KC_RBRC,    // Lightroom 5 stars, decrease rating, increase rating
        KC_X,    KC_U,    KC_P,       // Reject, unflag, flag as pick
        _______, _______, _______     // Rotoencoder press is the first in this row
    ),
    [2] = LAYOUT(
        KC_NO,   KC_NO,   KC_NO,
        KC_NO,   KC_NO,   KC_NO,
        _______, _______, _______     // Rotoencoder press is the first in this row
    ),
    [3] = LAYOUT(
        TO(0),   TO(1),   TO(2),
        _______, _______, _______,
        _______, _______, _______     // Rotoencoder press is the first in this row
    )
};

#if defined(ENCODER_MAP_ENABLE)
const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][NUM_DIRECTIONS] = {
    [0] =   { ENCODER_CCW_CW(KC_MINS, KC_EQL)},   // Lightroom decrease and increase adjustment value
    [1] =   { ENCODER_CCW_CW(KC_LEFT, KC_RIGHT)}, // Lightroom flip between photos
    [2] =   { ENCODER_CCW_CW(RGB_VAD, RGB_VAI)},  // Decrease and increase LED brightness
    [3] =   { ENCODER_CCW_CW(_______, _______)}
};
#endif

oled_rotation_t oled_init_kb(oled_rotation_t rotation) {
    return OLED_ROTATION_0;
}

#ifdef OLED_ENABLE
bool oled_task_kb(void) {

    if (!oled_task_user()) { return false; }
    // oled_clear();

    // static const char PROGMEM my_logo[] = {
    // // '遊舎工房ロゴ', 128x32px
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x00, 0x80, 0x80, 0xe4, 0xe4, 0xe6, 0xe2, 0xe2,
    // 0x82, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x8c, 0x8c, 0x8c, 0x9c, 0x18, 0x18, 0x10, 0x90, 0xc0, 0xc0,
    // 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x40, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0,
    // 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x40, 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0,
    // 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x40, 0x40, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0xc0, 0xdf, 0xdf, 0xdf, 0xdf, 0xdf, 0x80, 0xff, 0xff, 0x1f, 0xff, 0xff, 0xff, 0xf9,
    // 0x83, 0xef, 0xff, 0xff, 0xff, 0xfd, 0x9d, 0x01, 0x00, 0x08, 0x6c, 0x6e, 0x6f, 0x6f, 0x6f, 0x6f,
    // 0xf7, 0xf3, 0xf1, 0xf0, 0xf0, 0xf1, 0x67, 0x6f, 0x6f, 0x6f, 0x6f, 0x2f, 0x0e, 0x08, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0x03, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xff, 0xff, 0xff, 0xff, 0x7f, 0x23, 0x23, 0x23, 0xa3,
    // 0xa3, 0xa3, 0xa3, 0xa3, 0xbf, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
    // 0x60, 0x10, 0x0c, 0x06, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0xf0, 0xfe, 0xff, 0xff, 0xff, 0x8f, 0xf8, 0xff, 0x1f, 0x79, 0x7f, 0x7f, 0x7f, 0x1f, 0x79,
    // 0x7f, 0x7f, 0x7f, 0x7f, 0x1f, 0x01, 0x01, 0x00, 0xe2, 0xfb, 0xfb, 0xfb, 0xfb, 0x7b, 0x1b, 0x1b,
    // 0x1b, 0x1b, 0x1b, 0x1b, 0x1b, 0xfb, 0xfb, 0xfb, 0xfb, 0xfb, 0xfb, 0x03, 0x02, 0x08, 0x1c, 0x38,
    // 0x78, 0x70, 0x60, 0x00, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x1f, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0xe0, 0xfe, 0xff, 0xff, 0xff, 0x7f, 0x0f, 0xe3, 0xff, 0xff, 0xff, 0xff,
    // 0xff, 0x9f, 0xdb, 0xfb, 0xfb, 0xfb, 0xfb, 0xfb, 0x0b, 0x03, 0x10, 0x08, 0x04, 0x02, 0x01, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x07, 0x07, 0x07, 0x07, 0x07, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    // 0x03, 0x02, 0x06, 0x06, 0x02, 0x00, 0x00, 0x04, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x02, 0x02,
    // 0x02, 0x02, 0x02, 0x02, 0x06, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
    // 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x0b, 0x0b, 0x1b, 0x1b, 0x1b, 0x33, 0x33, 0x33,
    // 0x73, 0x63, 0x60, 0x67, 0x67, 0x67, 0x67, 0x67, 0x63, 0x24, 0x27, 0x27, 0x27, 0x17, 0x17, 0x03,
    // 0x01, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    // };
    // oled_write_raw_P(my_logo, sizeof(my_logo));

    oled_set_cursor(0, 3);  // oled_max_lines()-1

    switch (get_highest_layer(layer_state)) {
    case 0:
        oled_write_ln_P(PSTR("Adjust"), false);
        break;
    case 1:
        oled_write_ln_P(PSTR("Rate"), false);
        break;
    case 2:
        oled_write_ln_P(PSTR("LED"), false);
        break;
    case 3:
        oled_write_ln_P(PSTR("X"), false);
        break;
    default:
        // Or use the write_ln shortcut over adding '\n' to the end of your string
        oled_write_ln_P(PSTR("Undefined"), false);
    }

    // oled_set_cursor(0, 4);  // oled_max_lines()

    // Attempt at Caprincho
    // static const char PROGMEM raw_logo[] = {
    //     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,255,255,255,255,255,  3, 63,  1, 15,  6,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,128,  2,  4,  8, 16, 96,128,  0,  0,  0,128,  0,  0,  0, 20,255,251,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255, 63, 15, 15,255,255,255,251,195,195,128,  0, 64,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,176,208,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,224,192,224,
    //     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 60,127,  7,  1,127, 63, 14,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  2,134,  0,  0,  0, 24, 96,192,  0,  3, 62,240,  0,193,255,254,248,240,192,192,193,227,227,247,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255, 31,128,192,248,191, 63, 63,255,255,255,255,255,255,254,248,252,254,241,224,128, 64, 32,160,208,248,252,252,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255, 
    //     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,255, 63,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  8, 17,  3,  3,  3,  7,  7,  7, 14, 15, 31, 31, 15, 31, 31, 15, 15, 15, 15, 15, 15, 15, 15, 15, 31,127,127,255,255,127,127,127,127,127,127,127,255,255,255,255,255,255,255,255,127, 63, 63,127, 95, 31, 63, 47, 47, 31, 15, 31, 31, 31, 11, 15,  7,  3,  3,  1,  1,  0,128,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255, 
    //     0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,255,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  3, 27, 95, 31,191, 63, 63, 56, 32,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
    // };
    // oled_write_raw_P(raw_logo, sizeof(raw_logo));

    return false;

};
#endif

#if defined(RGBLIGHT_ENABLE) && defined(RGBLIGHT_LAYERS)
// Light ALL LEDs yellow
const rgblight_segment_t PROGMEM rgb_layer0[] = RGBLIGHT_LAYER_SEGMENTS(
    {0, 4, HSV_BLACK}
);
// Light LED 0
const rgblight_segment_t PROGMEM rgb_layer1[] = RGBLIGHT_LAYER_SEGMENTS(
    {0, 1, HSV_RED}
);
// Light LED 1
const rgblight_segment_t PROGMEM rgb_layer2[] = RGBLIGHT_LAYER_SEGMENTS(
    {1, 1, HSV_GREEN}
);
// Light LED 2
const rgblight_segment_t PROGMEM rgb_layer3[] = RGBLIGHT_LAYER_SEGMENTS(
    {2, 1, HSV_CYAN}
);
// Light LED 3
const rgblight_segment_t PROGMEM rgb_layer4[] = RGBLIGHT_LAYER_SEGMENTS(
    {3, 1, HSV_BLUE}
);
// Now define the array of layers. Later layers take precedence
const rgblight_segment_t* const PROGMEM rgb_layers[] = RGBLIGHT_LAYERS_LIST(
    rgb_layer0,
    rgb_layer1,
    rgb_layer2,
    rgb_layer3,
    rgb_layer4
);

void keyboard_post_init_user(void) {
    // Enable the LED layers
    rgblight_layers = rgb_layers;
};

bool led_update_user(led_t led_state) {
    // Turn on the default layer 0
    rgblight_set_layer_state(0, true);
    return true;
};

// Change the RGB Layer depending on the keyboard layer
layer_state_t layer_state_set_user(layer_state_t state) {
    rgblight_set_layer_state(1, layer_state_cmp(state, 0));
    rgblight_set_layer_state(2, layer_state_cmp(state, 1));
    rgblight_set_layer_state(3, layer_state_cmp(state, 2));
    rgblight_set_layer_state(4, layer_state_cmp(state, 3));
    return state;
};
#endif